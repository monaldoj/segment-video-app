bundle:
  name: segment-video-app

resources:
  apps:
    segment_video_app:
      name: segment-video-app
      description: "Upload a video + prompt; trigger Databricks Job to segment; display output from Volumes."
      source_code_path: ./app
  jobs:
    auto_segment_video:
      name: auto-segment-video
      email_notifications:
        on_failure:
          - justin.monaldo@databricks.com
        no_alert_for_skipped_runs: true
      notification_settings:
        no_alert_for_skipped_runs: true
      trigger:
        pause_status: PAUSED
        file_arrival:
          url: /Volumes/pubsec_video_processing/cv/auto_segment/inputs/
      max_concurrent_runs: 5
      permissions:
        - service_principal_name: caa20ee5-cc8b-44b3-8b92-50feec0ef85b
          level: CAN_MANAGE_RUN
      tasks:
        - task_key: auto-segment-video
          notebook_task:
            notebook_path: ./notebooks/job-auto-segment-video.ipynb
            base_parameters:
              trigger_location: "{{job.trigger.file_arrival.location}}"
              prompt: weimaraner
              frame_stride: "30"
              threshold: "0.5"
              truncate: "1"
            source: WORKSPACE
      queue:
        enabled: true
      # budget_policy_id: f20a71f9-ec07-4b92-a33f-9f3d3f23c428
      performance_target: PERFORMANCE_OPTIMIZED

targets:
  dev:
    default: true
    mode: development
  prod:
    mode: production
    workspace:
      root_path: /Workspace/Shared/pubsec_video_processing/


